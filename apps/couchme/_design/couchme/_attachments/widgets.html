<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>

<meta name="Description" content="CouchDB, NoSQL" />
<meta name="Keywords" content="CouchDB, NoSQL" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="Distribution" content="Global" />
<meta name="Author" content="Tamás Benke - tombenke@gmail.com" />
<meta name="Robots" content="index,follow" />

<link rel="stylesheet" href="images/Refresh.css" type="text/css" />

<title>Web-es alkalmazások fejlesztése couchDB-vel és CouchApp-pal</title>


</head>

<body>
<!-- wrap starts here -->
<div id="wrap">

		<!--header -->
		<div id="header">

			<h1 id="logo-text">Couch<span class="gray">Me</span></h1>
			<h2 id="slogan">Web-es alkalmazások fejlesztése CouchDB-vel</h2>

			<!--form class="search" method="post" action="#">
				<p>
	  			<input class="textbox" type="text" name="search_query" value="" />
	 			<input class="button" type="submit" name="Submit" value="Search" />
				</p>
			</form-->

		</div>

		<!-- menu -->
		<div  id="menu">
			<ul>
				<li id="current"><a href="index.html">Címlap</a></li>
				<li><a href="downloads.html">Letöltések</a></li>
				<li><a href="resources.html">Linkek</a></li>
			</ul>
		</div>

		<!-- content-wrap starts here -->
		<div id="content-wrap">

			<div id="sidebar">

				<h1>Tartalom</h1>
				<div class="left-box">
					<ul class="sidemenu">
						<li><a href="index.html">Címlap</a></li>
						<li><a href="intro.html">Bevezetés</a></li>
						<li><a href="install.html">Installálás</a></li>
						<li><a href="dataUpload.html">Adatfeltöltés</a></li>
						<li><a href="appdev.html">Alkalmazás-fejlesztés</a></li>
						<li><a href="views.html">Lekérdezések</a></li>
						<li><a href="shows.html">Dokumentum megjelenítés</a></li>
						<li><a href="lists.html">Listakészítés</a></li>
						<li><a href="widgets.html">Aktív megjelenítő komponensek</a></li>
					</ul>
				</div>

				<h1>Egyéb</h1>
				<div class="left-box">
					<ul class="sidemenu">
						<li><a href="downloads.html">Letöltések</a></li>
						<li><a href="resources.html">Linkek</a></li>
					</ul>
				</div>

				<!--h1>Wise Words</h1>
				<div class="left-box">
					<p>&quot;To be concious that you are ignorant of the
					facts is a great step to knowledge&quot; </p>

					<p class="align-right">- Benjamin Disraeli</p>
				</div>

				<h1>Support Styleshout</h1>
				<div class="left-box">
					<p>If you are interested in supporting my work and would like to contribute, you are
					welcome to make a small donation through the
					<a href="http://www.styleshout.com/">donate link</a> on my website - it will
					be a great help and will surely be appreciated.</p>
				</div-->


			</div>

			<div id="main">

				<a name="TemplateInfo"></a>
<h1>Aktív megjelenítő komponensek (widget-ek) készítése</h1>

<h2>Bevezetés</h2>

<p>Mielőtt elmerülnénk a részletekben, fontos tisztáznunk néhány alapvető kérdést,
amely első ránézésre nem biztos, hogy mindenki számára nyilvánvaló, de megválaszolásuk
fontos, hogy mielőbb megérthessük, hogyan is állnak össze az egyes komponensek
egy komplett rendszerré.</p>

<ol>
<li><p>Az adatbázisban dokumentumokat tárolunk, JSON  formátumban.</p></li>
<li><p>Az adatbázist a kliens oldalról REST API-n keresztül tudunk elérni. Ezt egy
közönséges HTTP klienssel, vagy egy erre a célra kifejlesztett HTTP kliens
könyvtárral tudjuk elvégezni. A CouchApp ezt még azzal egészíti ki, hogy
kliens oldalon rendelkezésre bocsájt egy JavaScript könyvtárat, amivel a
legfontosabb adatbázis műveleteket elvégezhetjük, ezzel elfedve az egyszerű
REST API réteget.</p></li>
<li><p>A server és kliens oldali programokat a készítésük során különálló folderekbe
és file-okba helyezzük, és a feltöltés során egy speciális dokumentumba
az ún. design-dokumentumba konvertáljuk, miután az egészet JSON-osítottuk.</p></li>
<li><p>Amikor a megjelenítő réteget fejlesztjük, HTML oldalakat állítunk elő.
Ezt kétféleképpen tehetjük meg:</p>

<ul>
<li><p>Teljes egészében a server oldalon állítjuk elő a végleges tartalmat.
Erre szolgálnak a <strong>_lists</strong> és <strong>_shows</strong> folderben elhelyezett
file-okban definiált függvények, illetve egyszerűbb esetben
az <strong>_attachments</strong> folderben elhelyezett állományok.</p></li>
<li><p>Aktív megjelenítő komponenseket is elhelyezünk az oldalban,
melyek a kliens oldalon futnak, és amellett, hogy a klasszikus
kliens oldali feladatokat (validálás, megjelenítés finomszabályozása, stb.)
ellátják, közvetlen adatbázisműveleteket is végrehajtanak, és az oldal
struktúráját is jelentősen befolyásolják, a kliens oldali template-ek
alkalmazásával.</p>

<p>Természetesen, ezen utóbbi esetben is, az alap oldalstruktúrát a server
oldalon fogjuk előállítani (lásd.: <strong>_shows</strong>, <strong>_lists</strong>, <strong>_attachments</strong>).</p></li>
</ul></li>
<li><p>Léteznek olyan könyvtárak (pl. a mustache, melyet a template kezeléshez alkalmazunk)
melyek mind kliens mind pedig server oldalon felhasználásra kerülnek.
Ezek mindegyike a design dokumentumba van bekódolva, és az oldal betöltődését
követően egy külön erre a célra szolgáló JavaScript alkalmazás végzi el
azok letöltését, és az oldalba történő beágyazását, aktiválását.</p></li>
</ol>

<p>Szeretném kiemelni, hogy ebben a fejezetben a kliens oldali aktív megjelenítő komponensekre
fókuszálunk. Ezeknek is két olyan tuljadonságára, ami "aktívvá" teszi őket:</p>

<ul>
<li><p>Adatbázis műveleteket és egyéb server irányú kéréseket hajtanak végre.</p></li>
<li><p>Interakciókat végeznek a felhasználóval, és esetleg egymással.</p></li>
</ul>

<p>Ebből kifolyólag teljesen mindegy, hogy a komponenseket magába foglaló HTML oldal
hogyan állt elő: statikus, vagy dinamikus módon.</p>

<p>Éppen ezért, hogy a lényegre tudjunk koncentrálni,
a widget mintákat gyűjteménybe foglaló
<a href="http://tombenke.couchone.com/widgets/_design/widgets/index.html">Widget receptek</a>
projekt is egyszerű, statikus HTML oldalakat alkalmaz a példák szemléltetésére.</p>

<h2>Tájékozódás a folder-struktúrában</h2>

<p>A CouchApp-pal készült alkalmazások JavaScript-tel valósítják meg a program logikát.
A CouchApp biztosít néhány JavaSript könyvtárat, amivel a HTML oldalon belül,
kiterjesztett jQuery komponenseket használhatunk.</p>

<p>Ezeket a kiterjesztett jQuery komponensek tulajdonképpen apró MVC kontrollerekként
is tekinthetjük.</p>

<p>Az aktív komponenseknek állapota van, és az állapotok közötti átmeneteket
a komponensnek küldött eseményekkel lehet kiváltani. Ezek az események lehetnek
szabványos böngésző események (click, mouse hover, stb.) de magunk is
definiálhatunk logikai eseményeket, melyeket trigger műveletekkel lehet aktiválni.</p>

<p>A komponensek az őket érintő események hatására megváltoztathatják állapotukat.
Minden egyes állapothoz tartozik egy megjelenítő template, és egy adatmodell,
amit a kiváltó esemény tölt fel, és ez az adat megjeleníthető a template-en keresztül.</p>

<p>Ezeket az aktív megjelenítő komponenseket továbbiakban widget-eknek fogjuk nevezni.</p>

<p>A widget-ek implementációjában az eseménykezelés, a megjelenítés és az adatok
kezelése el van különítve egymástól, és egy megfelelő formában kialaktott
folderstruktúrában, külön-külön forrásfile-okban helyezkedik el.</p>

<p>A CouchDB-s alkalmazásainkat a CouchApp segédprogram felhasználásával készítjük.
Ez a segédprogram támogat bennünket abban, hogy prototípus alkalmazásokat
generálhassunk. Ezek egy előre definiált folderstruktúrával rendelkeznek, és
rögtön tartalmazzák azokat a program könyvtárakat, amelyekre a böngésző oldalon
a megjelenítőréteget alapozhatjuk.</p>

<p>Az <a href="appdev.html">Alkalmazás-fejlesztés / Egy alkalmazás struktúrája</a> című fejezet
ismerteti egy couchApp által generált folderstruktúra elemeit, ezért itt csak
a widgetekhez szorosabban kapcsolódó file-okra és folderekre fogunk koncentrálni.</p>

<p>Az itt ismertetett mintapéldákat egy projektbe gyűjtöttem, ami reményeim szerint
idővel egy kisebb katalógusként fog szolgálni az újrafelhasználható widget
jellegű komponensek számára. A forráskód a
<a href="https://github.com/tombenke/widgets">https://github.com/tombenke/widgets</a>
repository-ból letölthető, a múködő változat pedig elérhető a web-en:
<a href="http://tombenke.couchone.com/widgets/_design/widgets/index.html">http://tombenke.couchone.com/widgets/_design/widgets/index.html</a>.</p>

<p>A widgets design dokumentum folder strutúráján keresztül szeretném bemutatni, hogy
az egyes komponensek hol találhatóak. Az ábra nem teljes, bizonyos részleteket
a jobb áttekinthetőség érdekében kihagytam:</p>

<pre><code>/widgets/_design/widgets
    |-- _attachments
    |   |-- scripts
    |   |   `-- gmap
    |   `-- style
    |       `-- smoothness
    |           `-- images
    |-- evently
    |   |-- auth
    |   |-- browser
    |   |-- contactManager
    |   |-- contactform
    |   |-- countryCombo
    |   |-- dbinfo
    |   |-- hCard
    |   |-- helloworld
    |   |-- items
    |   |-- logout
    |   |-- profile
    |   |-- searchform
    |   |-- searchresults
    |   |-- searchresults_reduced
    |   |-- simpleform
    |   `-- wizard
    |-- vendor
    |   |-- couchapp
    |   |   |-- _attachments
    |   |   |-- evently
    |   |   |   |-- account
    |   |   |   `-- profile
    |   |   `-- lib
    |   `-- droids
    |       `-- lib
    `-- views
</code></pre>

<h3>Az <strong>_attachments</strong> folder</h3>

<p>Ez olyan file-okat tartalmaz, amelyek demonstrációs céllal a widget-ek beágyazására
mutatnak példákat. Minden widget-hez tartozik egy html file, és van egy index.html
amely egy áttekintő listát ad az összes widgetről.</p>

<pre><code>.
|-- _attachments
|   |-- auth.html
|   |-- browser.html
|   |-- contactManager.html
|   |-- countryCombo.html
|   |-- dbinfo.html
|   |-- form.html
|   |-- gmaps.html
|   |-- hCard.html
|   |-- helloworld.html
|   |-- index.html
|   |-- logout.html
|   |-- poll.html
|   |-- search.html
|   |-- simpleform.html
|   |-- tabs.html
|   `-- wizard.html
.
</code></pre>

<p>Ugyancsak ebben a folderben vannak elhelyezve a stíluslapok, képe és mindazok a
JavaScript könyvtárak, amelyek az oldalak működéséhez szükségesek, de nem tartoznak 
sem a CouchApp csomaghoz, sem pedig a CouchDB könyvtáraihoz.</p>

<p>Az alábbi listán pl.: a jQuery alap könyvtár, továbbá az jQuery-UI könyvtár és
az ahhoz tartozó CSS és kép file-ok vannak felsorolva.</p>

<pre><code>.
|-- _attachments
|   |-- scripts
|   |   |-- gmap
|   |   |   `-- jquery.gmap-1.1.0-min.js
|   |   |-- jquery-1.4.2.min.js
|   |   `-- jquery-ui-1.8.2.custom.min.js
|   |-- style
|   |   |-- main.css
|   |   |-- smoothness
|   |   |   |-- images
|   |   |   |   |-- ui-anim_basic_16x16.gif
|   |   |   |   |-- ui-bg_flat_0_aaaaaa_40x100.png
|   |   |   |   |-- ui-bg_flat_75_ffffff_40x100.png
|   |   |   |   |-- ui-bg_glass_55_fbf9ee_1x400.png
|   |   |   |   |-- ui-bg_glass_65_ffffff_1x400.png
|   |   |   |   |-- ui-bg_glass_75_dadada_1x400.png
|   |   |   |   |-- ui-bg_glass_75_e6e6e6_1x400.png
|   |   |   |   |-- ui-bg_glass_95_fef1ec_1x400.png
|   |   |   |   |-- ui-bg_highlight-soft_75_cccccc_1x100.png
|   |   |   |   |-- ui-icons_222222_256x240.png
|   |   |   |   |-- ui-icons_2e83ff_256x240.png
|   |   |   |   |-- ui-icons_454545_256x240.png
|   |   |   |   |-- ui-icons_888888_256x240.png
|   |   |   |   `-- ui-icons_cd0a0a_256x240.png
|   |   |   `-- jquery-ui-1.8.2.custom.css
|   |   `-- wait16.gif
.
</code></pre>

<h3>Az <strong>evently</strong> folder</h3>

<p>Az <strong>evently</strong> folder áll vizsgálódásunk középpontjában, ez tartalmazza ugyanis
az aktív komponenseket. Komponensenként egy-egy aldirectory-ban.</p>

<p>Az alábbi listán két komponens folderstruktúrája látható, név szerint
a <strong>dbinfo</strong> és a <strong>helloworld</strong>. Az egyes widgetek saját, belső folderstruktúráját
egy további alfejezetben ismertetjük részletesen.</p>

<pre><code>.
|-- evently
|   |-- dbinfo
|   |   |-- _init
|   |   |   |-- after.js
|   |   |   `-- mustache.html
|   |   `-- version
|   |       |-- data.js
|   |       `-- mustache.html
|   |-- helloworld
|   |   |-- _init
|   |   |   `-- mustache.html
|   |   `-- click
|   |       `-- mustache.html
.
</code></pre>

<h3>A <strong>vendor</strong> folder</h3>

<pre><code>.
|-- vendor
|   |-- couchapp
|   |   |-- _attachments
|   |   |   |-- jquery.couch.app.js
|   |   |   |-- jquery.couch.app.util.js
|   |   |   |-- jquery.evently.js
|   |   |   |-- jquery.mustache.js
|   |   |   |-- jquery.pathbinder.js
|   |   |   `-- loader.js
|   |   |-- evently
|   |   |   |-- README.md
|   |   |   |-- account
|   |   |   `-- profile
|   |   |-- lib
|   |   |   |-- atom.js
|   |   |   |-- cache.js
|   |   |   |-- code.js
|   |   |   |-- docform.js
|   |   |   |-- linkup.js
|   |   |   |-- list.js
|   |   |   |-- markdown.js
|   |   |   |-- md5.js
|   |   |   |-- mustache.js
|   |   |   |-- path.js
|   |   |   |-- redirect.js
|   |   |   |-- utils.js
|   |   |   `-- validate.js
|   |   `-- metadata.json
|   `-- droids
|       `-- lib
|           |-- listgen.js
|           `-- templating.js
.
</code></pre>

<p>A vendor folderben előregyártott könyvtárakat és evently widget-eket találunk.</p>

<p>Számunkra most két folder érdekes:</p>

<p>A <strong>vendor/couchapp/\evently</strong> ahol két minta widget található, valamint a
 <strong>vendor/couchapp/_attachments</strong>, amelyben a kliens számára szükséges
következő JavaScript könyvtárakat találjuk:</p>

<ul>
<li><p><strong>jquery.evently.js</strong> <br />
Az Evently nevű, CouchDB-hez hangolt, deklaratív jQuery könyvtár,
amivel eseménykezelést, Ajax hívásokat, és sablonokat tudunk kezelni.
Ez képezi az általunk készítendő aktív megjelenítő komponensek bázisát.</p></li>
<li><p><strong>jquery.couch.js</strong> <br />
A CouchDB API-t megvalósító, adatbáziskezelést biztosító függvények.
Ez nem feltétlenül kerül ebben a directoryban elhelyezésre.
A CouchDB saját példányt biztosít a rajta futó alkalmazások számára, melynek
elérési útja: "/_utils/script/jquery.couch.js".</p></li>
<li><p><strong>jquery.couch.app.js</strong> <br />
CouchApp betöltő program, ami ahhoz szükséges, hogy a kliens oldalon futó
JavaScript alkalmazásunk elérhesse a design dokumentumban tárolt
widgeteket és könyvtárakat.</p></li>
<li><p><strong>jquery.pathbinder.js</strong> <br />
URL hash-en alapuló oldal hivatkozások aktiválását segítő keretrendszer.
<!-- TODO: Brrr. ezt rendesen le kell írni --></p></li>
<li><p><strong>jquery.mustache.js</strong> <br />
Mustache nevű, egyszerű template keretrendszer, ami a sablonokban használt 
bajuszra emlékeztető <strong>{</strong> és <strong>}</strong> karakterekről kapta nevét.</p></li>
</ul>

<h2>Egy widget anatómiája</h2>

<p>Minden egyes widget külön directory-ban helyezkedik el.
A widget-ek két helyen fordulhatnak elő: a design dokumentumban lévő evently folderben
és a vendor folder alatt. Ezen utóbbiban vendoronként lehet egy evently folder,
amiben a betöltő program megtalálja a widgeteket.</p>

<p>Vagyis a keresési útvonalak a betöltéskor:</p>

<ul>
<li><p><strong>{design-doc}/evently/*</strong></p></li>
<li><p><strong>{design-doc}/vendor/{vendor-name}/evently/*</strong></p></li>
</ul>

<p>Minden widget esetében három dolgot határozhatunk meg:</p>

<ul>
<li><p>Az eseményeket, amelyekre reagál.</p></li>
<li><p>A műveleteket, amelyeket az események kiváltásakor végrehajt.</p></li>
<li><p>A widget egyes állapotaihoz tartozó megjelenítést.</p></li>
</ul>

<p>A CouchApp lehetővé teszi számunkra, hogy egy konvencionális folder struktúrába
helyezzük forráskódunkat, melynek logikája a következő:</p>

<pre><code>{widget-name}
    `-- {event-name}
            |-- {template-name}.js
            `-- {activity-name}.js



{widget-name}
    |-- _init.js
    |-- _changes.js
    |-- {event-name}.js
    |-- {event-name}
    |   |-- async.js
    |   |-- before.js ???
    |   |-- after.js
    |   |-- query.js
    |   |-- data.js
    |   |-- all.html
    |   |-- mustache.html
    |   |-- path.txt
    |   |-- partials
    |   |   `-- *.html
    |   `-- selectors.json
        `-- selectors
            |-- [name=something]
            |   |-- _init
            |   `-- keyup
            `-- form
                `-- submit.js





auth
|-- _init.js
|-- doLogin.js
|-- doLogout.js
|-- loggedIn
|   |-- after.js
|   |-- data.js
|   |-- mustache.html
|   `-- selectors.json
|-- loggedOut
|   |-- mustache.html
|   `-- selectors.json
`-- loginForm
    |-- after.js
    |-- mustache.html
    `-- selectors
        `-- form
            `-- submit.js



items/
`-- _changes
    |-- data.js
    |-- mustache.html
    `-- query.json
</code></pre>

<h2>Widget példák</h2>

<h2>Összefoglaló a widget-ek struktúrájáról és használatáról</h2>

<!--
TODO: Témát tovább kifejteni részletesen!





b19eb87e753bdbff43365558c4ee5f70






086d192e22f47992be15ec0c475625ee




b19eb87e753bdbff43365558c4ee5f70






b6c02e808c76785e53def08e7d190beb




b19eb87e753bdbff43365558c4ee5f70




a $(document)ready() tetszőleges példányban használható.
A megadás sorrendjében fognak meghívódni.




b19eb87e753bdbff43365558c4ee5f70






dd2180fe5b15223c28bb411402deeae9


A: I would just put the code in _init.js, or _init/after.js if you wanted to run a mustache template first and then add flot.

A: Indeed. I also had to make sure to include the flot js script after loader.js.



868af544de1c3a41233750ef3f0d9bc1





868af544de1c3a41233750ef3f0d9bc1






b19eb87e753bdbff43365558c4ee5f70




-->
			</div>

		<!-- content-wrap ends here -->
		</div>

		<!--footer starts here-->
		<div id="footer">

			<p>
			&copy; 2010 <strong>TomBenke</strong> |
			Design by: <a href="http://www.styleshout.com/">styleshout</a> |
			Valid <a href="http://validator.w3.org/check?uri=referer">XHTML</a> |
			<a href="http://jigsaw.w3.org/css-validator/check/referer">CSS</a>
			 | Courtesy <a href="http://www.openwebdesign.org" target="_blank">Open Web Design</a>
			 <br/>
   		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

			<!--a href="index.html">Bevezetés</a>&nbsp;|&nbsp;
   		<a href="downloads.html">Letöltések</a>&nbsp;|&nbsp;
	   	<a href="resources.html">Linkek</a-->
   		</p>

		</div>

<!-- wrap ends here -->
</div>

</body>
</html>